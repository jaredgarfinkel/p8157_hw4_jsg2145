---
title: "20201119-p8157_hw4_jsg2145"
author: "Jared Garfinkel"
date: "11/19/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(viridis)
library(lme4)
library(geepack)
library(data.table)
library(gee)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	message = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis",
  scipen = 999
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

### Read in data

```{r}
data = read_delim(file = "./data/toenail.txt", delim = " ", col_names = c("id", "y", "treatment", "month", "visit"), skip = 1)

data
```

# Question 1

## Part 1

```{r}
df = data %>% 
  data.table()
# add response at lag 1 
df[,y_1 := shift(y,n=1,type="lag", fill = NA), by = "id"]
## transition probabilities 
tab1 <- table(df$y, df$y_1)
tab1
round(prop.table(tab1,margin = 1),2)
```

```{r}
# df
model_lag_1 <- gee(y ~ treatment * y_1 + month, corstr = "independence", family = binomial("logit"), id = id, data = df)
round(summary(model_lag_1)$coeff,2)
```
## Part 2

```{r}
df2 = data %>% 
  data.table()
# add response at lag 1 
df[,y_2 := shift(y,n=2,type="lag", fill = NA), by = "id"]
df2[,y_2 := shift(y,n=2,type="lag", fill = NA), by = "id"]
## transition probabilities 
tab2 <- table(df$y, df$y_2)
tab2
round(prop.table(tab2,margin = 1),2)
```

```{r}
model_lag_2 <- gee(y ~ treatment * y_2 + month, corstr = "independence", family = binomial("logit"), id = id, data = df2)
round(summary(model_lag_2)$coeff,2)
```

```{r}
model_lag_2b <- gee(y ~ treatment * (y_1 + y_2) + month, corstr = "independence", family = binomial("logit"), id = id, data = df)
round(summary(model_lag_2b)$coeff,2)
```

A second order model shows significant association between the second order lag and the outcome. When the first order lag variable is added back in, the second order variable remains significant.

## Part 3

The intercept is the log odds for those who were in the treatment group B who did not have onycholysis in the previous two visits.

The treatment estimate is the log odds for those who were in treatment group B who had an identical status for onycholysis in the previous visit and the visit before that.

The y_1 and y_2 variables are the log odds for those with and without onycholysis in their previous visit or second previous visit who currently have an identical status for treatment group.

The month variable is the log odds of having onycholysis holding treatment group and the status of onycholysis in the previous visit or second previous visit constant.

## Part 4

In these interpretations we assume that by conditioning on at least on lagged variable, all residual error can be due to random error.

# Question 2

## Part 1




